"0",""
"0","p_age_freq <- substitute("
"0","  expr = Plot(x = x, y = y, adjUsr = 0.25),"
"0","  env = list(x = catch[[""RelYear""]], y = rng_age)"
"0",")"
"0",""
"0","age_freq_tiles <- lapply(c(m = 'm', f = 'f'), FUN = function(s) {"
"0","  "
"0","  # for color bar & main figure"
"0","  lo <- layout(mat = 2:1, heights = c(0.15, 0.85))"
"0","  par(mar = c(0.5, 0.5, 0.5, 0.5), oma = c(2.5, 2.5, 0.5, 0.5))"
"0","  "
"0","  # to create empty plot"
"0","  p <- eval(p_age_freq)"
"0","  "
"0","  # still not sure about using grid for this figure"
"0","  # p$grid(xRng = TRUE)"
"0","  "
"0","  # to cycle through age frequencies for each release year"
"0","  o <- Map(f = function(x, af) {"
"0","    "
"0","    # get age frequency for specified sex"
"0","    d <- af[, s]"
"0","    a <- as.numeric(names(d))"
"0","    "
"0","    # change to between years (#1) or within year (#2)"
"0","    alpha <- sqrt(d / maxf[s]) #1"
"0","    # alpha <- sqrt(prop.table(d)) #2"
"0","    # alpha <- sqrt(d / sum(d)) #2"
"0","    "
"0","    # for heat map or tile plot"
"0","    col_tile <- rgb("
"0","      red = 0.27, "
"0","      green = 0.50, "
"0","      blue = 0.70,"
"0","      alpha = alpha"
"0","    )"
"0","    "
"0","    # to set 0 to obvious color"
"0","    col_tile[d == 0] <- ""grey60"""
"0","    "
"0","    # for adjusting size of tile in rect()"
"0","    adj <- 0.5"
"0","    "
"0","    # create tiles for each year & age"
"0","    rect("
"0","      xleft = x - adj, "
"0","      ybottom = a - adj,"
"0","      xright = x + adj, "
"0","      ytop = a + adj,"
"0","      col = col_tile, "
"0","      border = NA"
"0","    )"
"0","    "
"0","    # output for now but not sure this is needed"
"0","    data.frame(D = d, Clr = col_tile, stringsAsFactors = FALSE)"
"0","    "
"0","  }, x = catch[[""RelYear""]], af = catch[[""AgeFreq""]])"
"0","  # end Map"
"0","  "
"0","  # axis tick labeling & axis labels"
"0","  Axis(p, side = 1, labelAdj = 0.3)"
"0","  Axis(p, side = 2, labelAdj = 0.3)"
"0","  mtext(text = ""Year"", side = 1, line = 1.2)"
"0","  mtext(text = ""Age"", side = 2, line = 1.3)"
"0","  "
"0","  # to identify sex & max value used for color bar"
"0","  mtext("
"0","    text = paste("
"0","      c(m = ""\u2642"", f = ""\u2640"")[s],"
"0","      paste0(""max="", maxf[s]),"
"0","      sep = "" | """
"0","    ),"
"0","    side = 3,"
"0","    line = 0.25,"
"0","    adj = 0.95,"
"0","    col = ""grey50"","
"0","    cex = 1.0,"
"0","    font = 1"
"0","  )"
"0","  "
"0","  # for ease of using to create color bar"
"0","  o <- do.call(what = rbind, args = o)"
"0","  "
"0","  par(mar = c(1, 1.5, 1, 0.5))"
"0","  "
"0","  # create color bar plot here *************************************************"
"0","  p_cb <- Plot("
"0","    x = o[[""D""]],"
"0","    y = c(0.99, 1.01), "
"0","    x0 = TRUE,"
"0","    adjUsr = 1"
"0","  )"
"0","  "
"0","  # to establish x values where alpha = sqrt(xs / maxf[s])"
"0","  # n <- length(p_cb$data()[[""x""]]) * 1L"
"0","  n <- 100L"
"0","  xs <- seq("
"0","    # from = p_cb[[""xrng""]][[1]],"
"0","    from = 0,"
"0","    to = p_cb[[""xrng""]][[2]], "
"0","    length.out = n"
"0","  )"
"0","  "
"0","  # for height of color bar within plot"
"0","  ys <- p_cb[[""yrng""]] #+ c(0.008, -0.008)"
"0","  "
"0","  # not crazy about the extra code here to create the color bar but for now it"
"0","  # will suffice; would like to use data in `o` to reduce some of the redundancy"
"0","  "
"0","  col_tile <- rgb("
"0","    red = 0.27, "
"0","    green = 0.50, "
"0","    blue = 0.70,"
"0","    alpha = sqrt(xs / maxf[s])"
"0","  )"
"0","  "
"0","  col_tile[xs == 0] <- ""grey60"""
"0","  "
"0","  rect("
"0","    xleft = xs[-n],"
"0","    ybottom = ys[[1]],"
"0","    xright = xs[-1],"
"0","    ytop = ys[[2]], "
"0","    col = col_tile, "
"0","    border = NA"
"0","  )"
"0","  "
"0","  # to label tick marks with frequency intervals"
"0","  Axis(p_cb, side = 3, labelAdj = 0.2, cexAxis = 0.75)"
"0","  mtext("
"0","    text = ""age frequency color bar"","
"0","    side = 1, "
"0","    line = -0.2, "
"0","    cex = 0.75, "
"0","    col = ""grey50"", "
"0","    font = 3"
"0","  )"
"0","  # end color bar **************************************************************"
"0","  "
"0","  # no output for now"
"0","  invisible()"
"0","  "
"0","})"
